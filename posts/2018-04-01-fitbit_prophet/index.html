<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models | Dario Arcos-Díaz, PhD</title><meta name=keywords content="time series,wearables,forecasting"><meta name=description content="This is a time-series analysis of activity and sleep data from a fitbit user throughout a year. I use this data to predict an additional year of the life of the user using Generalized Additive Models."><meta name=author content="Dario Arcos-Díaz"><link rel=canonical href=https://www.arcosdiaz.com/blog/posts/2018-04-01-fitbit_prophet/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://www.arcosdiaz.com/blog/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.arcosdiaz.com/blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.arcosdiaz.com/blog/favicon-32x32.png><link rel=apple-touch-icon href=https://www.arcosdiaz.com/blog/apple-touch-icon.png><link rel=mask-icon href=https://www.arcosdiaz.com/blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.arcosdiaz.com/blog/posts/2018-04-01-fitbit_prophet/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2Q04SCXNNC"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2Q04SCXNNC")}</script><meta property="og:url" content="https://www.arcosdiaz.com/blog/posts/2018-04-01-fitbit_prophet/"><meta property="og:site_name" content="Dario Arcos-Díaz, PhD"><meta property="og:title" content="Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models"><meta property="og:description" content="This is a time-series analysis of activity and sleep data from a fitbit user throughout a year. I use this data to predict an additional year of the life of the user using Generalized Additive Models."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-04-01T00:00:00+00:00"><meta property="article:modified_time" content="2018-04-01T00:00:00+00:00"><meta property="article:tag" content="Time Series"><meta property="article:tag" content="Wearables"><meta property="article:tag" content="Forecasting"><meta property="og:image" content="https://www.arcosdiaz.com/images/fitbit_prophet_thumb.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.arcosdiaz.com/images/fitbit_prophet_thumb.png"><meta name=twitter:title content="Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models"><meta name=twitter:description content="This is a time-series analysis of activity and sleep data from a fitbit user throughout a year. I use this data to predict an additional year of the life of the user using Generalized Additive Models."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://www.arcosdiaz.com/blog/posts/"},{"@type":"ListItem","position":2,"name":"Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models","item":"https://www.arcosdiaz.com/blog/posts/2018-04-01-fitbit_prophet/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models","name":"Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models","description":"This is a time-series analysis of activity and sleep data from a fitbit user throughout a year. I use this data to predict an additional year of the life of the user using Generalized Additive Models.","keywords":["time series","wearables","forecasting"],"articleBody":"The goal of this notebook is to provide an analysis of the time-series data from a user of a fitbit tracker throughout a year. I will use this data to predict an additional year of the life of the user using Generalized Additive Models.\nData source: Activity, Sleep\nPackages used:\npandas, numpy, matplotlib, seaborn Prophet import pandas as pd import numpy as np from fbprophet import Prophet import matplotlib.pyplot as plt import seaborn as sns %matplotlib inline Data cleaning (missing data and outliers) # import the activity data activity = pd.read_csv('OneYearFitBitData.csv') # change commas to dots activity.iloc[:,1:] = activity.iloc[:,1:].applymap(lambda x: float(str(x).replace(',','.'))) # change column names to English activity.columns = ['Date', 'BurnedCalories', 'Steps', 'Distance', 'Floors', 'SedentaryMinutes', 'LightMinutes', 'ModerateMinutes', 'IntenseMinutes', 'IntenseActivityCalories'] # import the sleep data sleep = pd.read_csv('OneYearFitBitDataSleep.csv') # check the size of the dataframes activity.shape, sleep.shape # merge dataframes data = pd.merge(activity, sleep, how='outer', on='Date') # parse date into correct format data['Date'] = pd.to_datetime(data['Date'], format='%d-%m-%Y') # correct units for Calories and Steps for c in ['BurnedCalories', 'Steps', 'IntenseActivityCalories']: data[c] = data[c]*1000 Once imported, we should check for any missing data:\n# check for missing data data.isnull().sum() Date 0 BurnedCalories 0 Steps 0 Distance 0 Floors 0 SedentaryMinutes 0 LightMinutes 0 ModerateMinutes 0 IntenseMinutes 0 IntenseActivityCalories 0 MinutesOfSleep 5 MinutesOfBeingAwake 5 NumberOfAwakings 5 LengthOfRestInMinutes 5 dtype: int64 # check complete rows where sleep data is missing data.iloc[np.where(data['MinutesOfSleep'].isnull())[0],:] .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } We can see that the sleep information was missing for some dates. The activity information for those days is complete. Therefore, we should not get rid of those rows just now.\n# check rows for which steps count is zero data.iloc[np.where(data['Steps']==0)[0],:] .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } We can also see that the step count for some datapoints is zero. If we look at the complete rows, we can see that on those days nearly no other data was recorded. I assume that the user probably did not wear the fitness tracker on that day and we could get rid of those complete rows.\n# drop days with a step count of zero data = data.drop(np.where(data['Steps']==0)[0], axis=0) # plot the distribution of data for step count sns.distplot(data['Steps']) plt.title('Histogram for step count') Step count is probably the most accurate measure obtained from a pedometer. Looking at the distribution of this variable, however, we can see that there is a chance that we have outliers in the data, as at least one value seems to be much higher than all the rest.\n# sort data by step count in a descending order data.sort_values(by='Steps', ascending=False).head() .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } We found the outlier! It seems that the step count for the first day (our data starts on May 8th, 2015) is too high to be a correct value for the amount of steps taken by the user on that day. Maybe the device saves the vibration since its production as step count which is loaded on the first day that the user wears the tracker. We can anyway get rid of that row since the sleep data is also not available for this day.\n# drop outlier data = data.drop(np.where(data['Steps']\u003e=100000)[0], axis=0) Now we can look at our preprocessed data. Shape, distribution of the variables, and a look at some rows from the dataframe, are all useful things to observe:\ndata.shape (369, 14) fig, ax = plt.subplots(5,3, figsize=(8,10)) for c, a in zip(data.columns[1:], ax.flat): df = pd.DataFrame() df['ds'] = data['Date'] df['y'] = data[c] df = df.dropna(axis=0, how='any') sns.distplot(df['y'], axlabel=False, ax=a) a.set_title(c) plt.suptitle('Histograms of variables from fitbit data', y=1.02, fontsize=14); plt.tight_layout() data.head() .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } Predicting the step count for an additional year In order to use the Prophet package to predict the future using a Generalized Additive Model, we need to create a dataframe with columns ds and y (we need to do this for each variable):\nds is the date stamp data giving the time component y is the variable that we want to predict In our case we will use the log transform of the step count in order to decrease the effect of outliers on the model.\ndf = pd.DataFrame() df['ds'] = data['Date'] df['y'] = data['Steps'] # log-transform of step count df['y'] = np.log(df['y']) Now we need to specify the type of growth model that we want to use:\nLinear: assumes that the variable y grows linearly in time (doesn’t apply to our step count scenario, if the person sticks to their normal lifestyle) Logistic: assumes that the variable y grows logistically in time and saturates at some point I will assume that the person, for whom we want to predict the step count in the following year, will not have any dramatic lifestyle changes that makes them start to walk more. Therefore, I am using logistic ‘growth’ capped to a cap of the mean of the data, which in practice means that the step count’s growth trend will be ‘zero growth’.\ndf['cap'] = df['y'].median() m = Prophet(growth='logistic', yearly_seasonality=True) m.fit(df) INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. /Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`. elif np.issubdtype(np.asarray(v).dtype, float): After fitting the model, we need a new dataframe future with the additional rows for which we want to predict y.\nfuture = m.make_future_dataframe(periods=365, freq='D') future['cap'] = df['y'].median() Now we can call predict on the fitted model and obtain relevant statistics for the forecast period. We can also plot the results.\nforecast = m.predict(future) forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail() .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; } m.plot(forecast, ylabel='log(Steps)', xlabel='Date'); plt.title('1-year prediction of step count from 1 year of fitbit data'); We can see that the model did a good job in mimicking the behavior of step count during the year for which the data was available. This seems reasonable, as we do not expect the pattern to vary necessarily, if the person continues to have a similar lifestyle.\nAdditionally, we can plot the components from the Generalized Additive Model and see their effect on the ‘y’ variable. In this case we have the general trend (remember we capped this at ‘10’), the yearly seasonality effect, and the weekly effect.\nm.plot_components(forecast); plt.suptitle('GAM components for prediction of step count', y=1.02, fontsize=14); Here we see some interesting patterns:\nThe general ‘growth’ trend is as expected, as we assumed that there would be no growth beyond the mean of the existing data. The yearly effect shows a trend towards higher activity during the summer months, however the variation is considerable, probably due to the fact that our dataset consisted of the data for one year only The weekly effect shows that Sunday is a day of lower activity for this person whereas Saturday is the day where the activity is the highest. So, grocery shopping on Saturday, Netflix on Sunday? :) Sleep analysis A very important part of our lives is sleep. It would be very interesting to look at the sleep habits of the user of the fitness tracker and see if we can get some insights from this data.\ndf = pd.DataFrame() df['ds'] = data['Date'] df['y'] = data['MinutesOfSleep'] df = df.dropna(axis=0, how='any') # drop rows where sleep time is zero, as this would mean that the person did not wear the tracker overnight and the data is missing df = df.iloc[np.where(df['y']!=0)[0],:] # distribution of MinutesOfSleep sns.distplot(df['y']) df['cap'] = df['y'].median() m = Prophet(growth='logistic', yearly_seasonality=True) m.fit(df) future = m.make_future_dataframe(periods=365, freq='D') future['cap'] = df['y'].median() forecast = m.predict(future) m.plot(forecast); plt.title('1-year prediction of MinutesOfSleep from 1 year of fitbit data'); INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. /Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`. elif np.issubdtype(np.asarray(v).dtype, float): The model again seems to predict a similar sleep behavior for the predicted year. This seems reasonable, as we do not expect the pattern to vary necessarily, if the person continues to have a similar lifestyle.\nm.plot_components(forecast); plt.suptitle('GAM components for prediction of MinutesOfSleep', y=1.02, fontsize=14); A look at the amount of sleep reveals:\nA saturation trend at the median (we set this assumption) A yearly effect shows a trend towards higher amount of sleep during the summer months, with more variation during winter The weekly effect shows lowest sleep amount on Mondays (maybe going to bed late on Sunday and waking up early on Monday is a pattern for this user). Highest amout of sleep occurs on Saturdays (no alarm to wake up to on Saturday morning!). Interestingly, the user seems to get more sleep on Wednesdays than on Mondays or Tuesdays, which could mean that their work schedule is not constant during week-days. Appendix As an exercise, I have plotted the predictions for the most interesing variables in the dataset. Enjoy!\nzeros_allowed = ['Floors', 'SedentaryMinutes', 'LightMinutes', 'ModerateMinutes', 'IntenseMinutes', 'IntenseActivityCalories', 'MinutesOfBeingAwake', 'NumberOfAwakings'] fig, ax = plt.subplots(3,3, figsize=(12,6), sharex=True) predict_cols = ['Steps', 'Floors', 'BurnedCalories', 'LightMinutes', 'ModerateMinutes', 'IntenseMinutes', 'MinutesOfSleep', 'MinutesOfBeingAwake', 'NumberOfAwakings'] for c, a in zip(predict_cols, ax.flat): df = pd.DataFrame() df['ds'] = data['Date'] df['y'] = data[c] df = df.dropna(axis=0, how='any') if c not in zeros_allowed: df = df.iloc[np.where(df['y']!=0)[0],:] df['cap'] = df['y'].median() m = Prophet(growth='logistic', yearly_seasonality=True) m.fit(df) future = m.make_future_dataframe(periods=365, freq='D') future['cap'] = df['y'].median() future.tail() forecast = m.predict(future) forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail() m.plot(forecast, xlabel='', ax=a); a.set_title(c) #m.plot_components(forecast); plt.suptitle('1-year prediction per variable from 1 year of fitbit data', y=1.02, fontsize=14); plt.tight_layout() INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. /Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`. elif np.issubdtype(np.asarray(v).dtype, float): INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this. ","wordCount":"1732","inLanguage":"en","image":"https://www.arcosdiaz.com/images/fitbit_prophet_thumb.png","datePublished":"2018-04-01T00:00:00Z","dateModified":"2018-04-01T00:00:00Z","author":{"@type":"Person","name":"Dario Arcos-Díaz"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.arcosdiaz.com/blog/posts/2018-04-01-fitbit_prophet/"},"publisher":{"@type":"Organization","name":"Dario Arcos-Díaz, PhD","logo":{"@type":"ImageObject","url":"https://www.arcosdiaz.com/blog/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://www.arcosdiaz.com/blog/ accesskey=h title="Dario Arcos-Díaz, PhD (Alt + H)">Dario Arcos-Díaz, PhD</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.arcosdiaz.com/blog/about/ title=About><span>About</span></a></li><li><a href=https://www.arcosdiaz.com/blog/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.arcosdiaz.com/blog/>Home</a>&nbsp;»&nbsp;<a href=https://www.arcosdiaz.com/blog/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Fitbit activity and sleep data: a time-series analysis with Generalized Additive Models</h1><div class=post-description>This is a time-series analysis of activity and sleep data from a fitbit user throughout a year. I use this data to predict an additional year of the life of the user using Generalized Additive Models.</div><div class=post-meta><span title='2018-04-01 00:00:00 +0000 UTC'>April 1, 2018</span>&nbsp;·&nbsp;<span>9 min</span>&nbsp;·&nbsp;<span>Dario Arcos-Díaz</span></div></header><figure class=entry-cover><img loading=eager src=https://www.arcosdiaz.com/images/fitbit_prophet_thumb.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#data-cleaning-missing-data-and-outliers aria-label="Data cleaning (missing data and outliers)">Data cleaning (missing data and outliers)</a></li><li><a href=#predicting-the-step-count-for-an-additional-year aria-label="Predicting the step count for an additional year">Predicting the step count for an additional year</a></li><li><a href=#sleep-analysis aria-label="Sleep analysis">Sleep analysis</a><ul><li><a href=#appendix aria-label=Appendix>Appendix</a></li></ul></li></ul></div></details></div><div class=post-content><p>The goal of this notebook is to provide an analysis of the time-series data from a user of a fitbit tracker throughout a year. I will use this data to predict an additional year of the life of the user using <a href=https://en.wikipedia.org/wiki/Generalized_additive_model>Generalized Additive Models</a>.</p><p><a href=https://algo-data.quora.com/Data-sets-of-any-type-some-links>Data source</a>: <a href="https://drive.google.com/open?id=0Bx4yoK5aogTSbGJ2WlkwYjlHejQ">Activity</a>, <a href="https://drive.google.com/open?id=0Bx4yoK5aogTSMUFqRjVNcko5WlU">Sleep</a></p><p>Packages used:</p><ul><li>pandas, numpy, matplotlib, seaborn</li><li><a href=https://github.com/facebook/prophet>Prophet</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> fbprophet <span style=color:#f92672>import</span> Prophet
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> seaborn <span style=color:#66d9ef>as</span> sns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span>matplotlib inline
</span></span></code></pre></div><h2 id=data-cleaning-missing-data-and-outliers>Data cleaning (missing data and outliers)<a hidden class=anchor aria-hidden=true href=#data-cleaning-missing-data-and-outliers>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># import the activity data</span>
</span></span><span style=display:flex><span>activity <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#39;OneYearFitBitData.csv&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># change commas to dots</span>
</span></span><span style=display:flex><span>activity<span style=color:#f92672>.</span>iloc[:,<span style=color:#ae81ff>1</span>:] <span style=color:#f92672>=</span> activity<span style=color:#f92672>.</span>iloc[:,<span style=color:#ae81ff>1</span>:]<span style=color:#f92672>.</span>applymap(<span style=color:#66d9ef>lambda</span> x: float(str(x)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;,&#39;</span>,<span style=color:#e6db74>&#39;.&#39;</span>)))
</span></span><span style=display:flex><span><span style=color:#75715e># change column names to English</span>
</span></span><span style=display:flex><span>activity<span style=color:#f92672>.</span>columns <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Date&#39;</span>, <span style=color:#e6db74>&#39;BurnedCalories&#39;</span>, <span style=color:#e6db74>&#39;Steps&#39;</span>, <span style=color:#e6db74>&#39;Distance&#39;</span>, <span style=color:#e6db74>&#39;Floors&#39;</span>, <span style=color:#e6db74>&#39;SedentaryMinutes&#39;</span>, <span style=color:#e6db74>&#39;LightMinutes&#39;</span>, <span style=color:#e6db74>&#39;ModerateMinutes&#39;</span>, <span style=color:#e6db74>&#39;IntenseMinutes&#39;</span>, <span style=color:#e6db74>&#39;IntenseActivityCalories&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#75715e># import the sleep data</span>
</span></span><span style=display:flex><span>sleep <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#39;OneYearFitBitDataSleep.csv&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># check the size of the dataframes</span>
</span></span><span style=display:flex><span>activity<span style=color:#f92672>.</span>shape, sleep<span style=color:#f92672>.</span>shape
</span></span><span style=display:flex><span><span style=color:#75715e># merge dataframes</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>merge(activity, sleep, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;outer&#39;</span>, on<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Date&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># parse date into correct format</span>
</span></span><span style=display:flex><span>data[<span style=color:#e6db74>&#39;Date&#39;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(data[<span style=color:#e6db74>&#39;Date&#39;</span>], format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>-%m-%Y&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># correct units for Calories and Steps</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;BurnedCalories&#39;</span>, <span style=color:#e6db74>&#39;Steps&#39;</span>, <span style=color:#e6db74>&#39;IntenseActivityCalories&#39;</span>]:
</span></span><span style=display:flex><span>    data[c] <span style=color:#f92672>=</span> data[c]<span style=color:#f92672>*</span><span style=color:#ae81ff>1000</span>
</span></span></code></pre></div><p>Once imported, we should check for any missing data:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># check for missing data</span>
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>isnull()<span style=color:#f92672>.</span>sum()
</span></span></code></pre></div><pre><code>Date                       0
BurnedCalories             0
Steps                      0
Distance                   0
Floors                     0
SedentaryMinutes           0
LightMinutes               0
ModerateMinutes            0
IntenseMinutes             0
IntenseActivityCalories    0
MinutesOfSleep             5
MinutesOfBeingAwake        5
NumberOfAwakings           5
LengthOfRestInMinutes      5
dtype: int64
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># check complete rows where sleep data is missing</span>
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>iloc[np<span style=color:#f92672>.</span>where(data[<span style=color:#e6db74>&#39;MinutesOfSleep&#39;</span>]<span style=color:#f92672>.</span>isnull())[<span style=color:#ae81ff>0</span>],:]
</span></span></code></pre></div><pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre><p></p><p>We can see that the sleep information was missing for some dates. The activity information for those days is complete. Therefore, we should not get rid of those rows just now.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># check rows for which steps count is zero</span>
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>iloc[np<span style=color:#f92672>.</span>where(data[<span style=color:#e6db74>&#39;Steps&#39;</span>]<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>)[<span style=color:#ae81ff>0</span>],:]
</span></span></code></pre></div><pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre><p></p><p>We can also see that the step count for some datapoints is zero. If we look at the complete rows, we can see that on those days nearly no other data was recorded. I assume that the user probably did not wear the fitness tracker on that day and we could get rid of those complete rows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># drop days with a step count of zero</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>drop(np<span style=color:#f92672>.</span>where(data[<span style=color:#e6db74>&#39;Steps&#39;</span>]<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>)[<span style=color:#ae81ff>0</span>], axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># plot the distribution of data for step count</span>
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>distplot(data[<span style=color:#e6db74>&#39;Steps&#39;</span>])
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#39;Histogram for step count&#39;</span>)
</span></span></code></pre></div><pre><code>&lt;matplotlib.text.Text at 0x10fb34cc0&gt;
</code></pre><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_12_1.png></p><p>Step count is probably the most accurate measure obtained from a pedometer. Looking at the distribution of this variable, however, we can see that there is a chance that we have outliers in the data, as at least one value seems to be much higher than all the rest.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># sort data by step count in a descending order</span>
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Steps&#39;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre><p></p><p>We found the outlier! It seems that the step count for the first day (our data starts on May 8th, 2015) is too high to be a correct value for the amount of steps taken by the user on that day. Maybe the device saves the vibration since its production as step count which is loaded on the first day that the user wears the tracker. We can anyway get rid of that row since the sleep data is also not available for this day.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># drop outlier</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>drop(np<span style=color:#f92672>.</span>where(data[<span style=color:#e6db74>&#39;Steps&#39;</span>]<span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>100000</span>)[<span style=color:#ae81ff>0</span>], axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><p>Now we can look at our preprocessed data. Shape, distribution of the variables, and a look at some rows from the dataframe, are all useful things to observe:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>data<span style=color:#f92672>.</span>shape
</span></span></code></pre></div><pre><code>(369, 14)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>fig, ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots(<span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>3</span>, figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>10</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> c, a <span style=color:#f92672>in</span> zip(data<span style=color:#f92672>.</span>columns[<span style=color:#ae81ff>1</span>:], ax<span style=color:#f92672>.</span>flat):
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;ds&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;Date&#39;</span>]
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;y&#39;</span>] <span style=color:#f92672>=</span> data[c]
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>dropna(axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;any&#39;</span>)
</span></span><span style=display:flex><span>    sns<span style=color:#f92672>.</span>distplot(df[<span style=color:#e6db74>&#39;y&#39;</span>], axlabel<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, ax<span style=color:#f92672>=</span>a)
</span></span><span style=display:flex><span>    a<span style=color:#f92672>.</span>set_title(c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>suptitle(<span style=color:#e6db74>&#39;Histograms of variables from fitbit data&#39;</span>, y<span style=color:#f92672>=</span><span style=color:#ae81ff>1.02</span>, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>);
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>tight_layout()
</span></span></code></pre></div><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_19_0.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>data<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre><p></p><h2 id=predicting-the-step-count-for-an-additional-year>Predicting the step count for an additional year<a hidden class=anchor aria-hidden=true href=#predicting-the-step-count-for-an-additional-year>#</a></h2><p>In order to use the Prophet package to predict the future using a Generalized Additive Model, we need to create a dataframe with columns <code>ds</code> and <code>y</code> (we need to do this for each variable):</p><ul><li><code>ds</code> is the date stamp data giving the time component</li><li><code>y</code> is the variable that we want to predict</li></ul><p>In our case we will use the log transform of the step count in order to decrease the effect of outliers on the model.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;ds&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;Date&#39;</span>]
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;y&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;Steps&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#75715e># log-transform of step count</span>
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;y&#39;</span>] <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>log(df[<span style=color:#e6db74>&#39;y&#39;</span>])
</span></span></code></pre></div><p>Now we need to specify the type of growth model that we want to use:</p><ul><li>Linear: assumes that the variable <code>y</code> grows linearly in time (doesn&rsquo;t apply to our step count scenario, if the person sticks to their normal lifestyle)</li><li>Logistic: assumes that the variable <code>y</code> grows logistically in time and saturates at some point</li></ul><p>I will assume that the person, for whom we want to predict the step count in the following year, will not have any dramatic lifestyle changes that makes them start to walk more. Therefore, I am using logistic &lsquo;growth&rsquo; capped to a cap of the mean of the data, which in practice means that the step count&rsquo;s growth trend will be &lsquo;zero growth&rsquo;.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>df[<span style=color:#e6db74>&#39;cap&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>.</span>median()
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> Prophet(growth<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;logistic&#39;</span>, yearly_seasonality<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>m<span style=color:#f92672>.</span>fit(df)
</span></span></code></pre></div><pre><code>INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
/Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  elif np.issubdtype(np.asarray(v).dtype, float):





&lt;fbprophet.forecaster.Prophet at 0x115274dd8&gt;
</code></pre><p>After fitting the model, we need a new dataframe <code>future</code> with the additional rows for which we want to predict <code>y</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>future <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>make_future_dataframe(periods<span style=color:#f92672>=</span><span style=color:#ae81ff>365</span>, freq<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;D&#39;</span>)
</span></span><span style=display:flex><span>future[<span style=color:#e6db74>&#39;cap&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>.</span>median()
</span></span></code></pre></div><p>Now we can call predict on the fitted model and obtain relevant statistics for the forecast period. We can also plot the results.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>forecast <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>predict(future)
</span></span><span style=display:flex><span>forecast[[<span style=color:#e6db74>&#39;ds&#39;</span>, <span style=color:#e6db74>&#39;yhat&#39;</span>, <span style=color:#e6db74>&#39;yhat_lower&#39;</span>, <span style=color:#e6db74>&#39;yhat_upper&#39;</span>]]<span style=color:#f92672>.</span>tail()
</span></span></code></pre></div><pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}
</code></pre><p></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>m<span style=color:#f92672>.</span>plot(forecast, ylabel<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;log(Steps)&#39;</span>, xlabel<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Date&#39;</span>);
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#39;1-year prediction of step count from 1 year of fitbit data&#39;</span>);
</span></span></code></pre></div><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_30_0.png></p><p>We can see that the model did a good job in mimicking the behavior of step count during the year for which the data was available. This seems reasonable, as we do not expect the pattern to vary necessarily, if the person continues to have a similar lifestyle.</p><p>Additionally, we can plot the components from the Generalized Additive Model and see their effect on the &lsquo;y&rsquo; variable. In this case we have the general trend (remember we capped this at &lsquo;10&rsquo;), the yearly seasonality effect, and the weekly effect.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>m<span style=color:#f92672>.</span>plot_components(forecast);
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>suptitle(<span style=color:#e6db74>&#39;GAM components for prediction of step count&#39;</span>, y<span style=color:#f92672>=</span><span style=color:#ae81ff>1.02</span>, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>);
</span></span></code></pre></div><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_33_0.png></p><p>Here we see some interesting patterns:</p><ul><li>The general &lsquo;growth&rsquo; trend is as expected, as we assumed that there would be no growth beyond the mean of the existing data.</li><li>The yearly effect shows a trend towards higher activity during the summer months, however the variation is considerable, probably due to the fact that our dataset consisted of the data for one year only</li><li>The weekly effect shows that Sunday is a day of lower activity for this person whereas Saturday is the day where the activity is the highest. So, grocery shopping on Saturday, Netflix on Sunday? :)</li></ul><h2 id=sleep-analysis>Sleep analysis<a hidden class=anchor aria-hidden=true href=#sleep-analysis>#</a></h2><p>A very important part of our lives is sleep. It would be very interesting to look at the sleep habits of the user of the fitness tracker and see if we can get some insights from this data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;ds&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;Date&#39;</span>]
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;y&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;MinutesOfSleep&#39;</span>]
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>dropna(axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;any&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># drop rows where sleep time is zero, as this would mean that the person did not wear the tracker overnight and the data is missing</span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>iloc[np<span style=color:#f92672>.</span>where(df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>!=</span><span style=color:#ae81ff>0</span>)[<span style=color:#ae81ff>0</span>],:]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># distribution of MinutesOfSleep</span>
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>distplot(df[<span style=color:#e6db74>&#39;y&#39;</span>])
</span></span></code></pre></div><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1163770f0&gt;
</code></pre><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_38_1.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>df[<span style=color:#e6db74>&#39;cap&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>.</span>median()
</span></span><span style=display:flex><span>m <span style=color:#f92672>=</span> Prophet(growth<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;logistic&#39;</span>, yearly_seasonality<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>m<span style=color:#f92672>.</span>fit(df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>future <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>make_future_dataframe(periods<span style=color:#f92672>=</span><span style=color:#ae81ff>365</span>, freq<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;D&#39;</span>)
</span></span><span style=display:flex><span>future[<span style=color:#e6db74>&#39;cap&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>.</span>median()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>forecast <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>predict(future)
</span></span><span style=display:flex><span>m<span style=color:#f92672>.</span>plot(forecast);
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>title(<span style=color:#e6db74>&#39;1-year prediction of MinutesOfSleep from 1 year of fitbit data&#39;</span>);
</span></span></code></pre></div><pre><code>INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
/Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  elif np.issubdtype(np.asarray(v).dtype, float):
</code></pre><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_39_1.png></p><p>The model again seems to predict a similar sleep behavior for the predicted year. This seems reasonable, as we do not expect the pattern to vary necessarily, if the person continues to have a similar lifestyle.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>m<span style=color:#f92672>.</span>plot_components(forecast);
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>suptitle(<span style=color:#e6db74>&#39;GAM components for prediction of MinutesOfSleep&#39;</span>, y<span style=color:#f92672>=</span><span style=color:#ae81ff>1.02</span>, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>);
</span></span></code></pre></div><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_41_0.png></p><p>A look at the amount of sleep reveals:</p><ul><li>A saturation trend at the median (we set this assumption)</li><li>A yearly effect shows a trend towards higher amount of sleep during the summer months, with more variation during winter</li><li>The weekly effect shows lowest sleep amount on Mondays (maybe going to bed late on Sunday and waking up early on Monday is a pattern for this user). Highest amout of sleep occurs on Saturdays (no alarm to wake up to on Saturday morning!). Interestingly, the user seems to get more sleep on Wednesdays than on Mondays or Tuesdays, which could mean that their work schedule is not constant during week-days.</li></ul><h3 id=appendix>Appendix<a hidden class=anchor aria-hidden=true href=#appendix>#</a></h3><p>As an exercise, I have plotted the predictions for the most interesing variables in the dataset. Enjoy!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>zeros_allowed <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Floors&#39;</span>, <span style=color:#e6db74>&#39;SedentaryMinutes&#39;</span>, <span style=color:#e6db74>&#39;LightMinutes&#39;</span>, <span style=color:#e6db74>&#39;ModerateMinutes&#39;</span>, <span style=color:#e6db74>&#39;IntenseMinutes&#39;</span>, <span style=color:#e6db74>&#39;IntenseActivityCalories&#39;</span>, <span style=color:#e6db74>&#39;MinutesOfBeingAwake&#39;</span>, <span style=color:#e6db74>&#39;NumberOfAwakings&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fig, ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots(<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>3</span>, figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>12</span>,<span style=color:#ae81ff>6</span>), sharex<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>predict_cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;Steps&#39;</span>, <span style=color:#e6db74>&#39;Floors&#39;</span>, <span style=color:#e6db74>&#39;BurnedCalories&#39;</span>, <span style=color:#e6db74>&#39;LightMinutes&#39;</span>, <span style=color:#e6db74>&#39;ModerateMinutes&#39;</span>, <span style=color:#e6db74>&#39;IntenseMinutes&#39;</span>, <span style=color:#e6db74>&#39;MinutesOfSleep&#39;</span>, <span style=color:#e6db74>&#39;MinutesOfBeingAwake&#39;</span>, <span style=color:#e6db74>&#39;NumberOfAwakings&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> c, a <span style=color:#f92672>in</span> zip(predict_cols, ax<span style=color:#f92672>.</span>flat):
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;ds&#39;</span>] <span style=color:#f92672>=</span> data[<span style=color:#e6db74>&#39;Date&#39;</span>]
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;y&#39;</span>] <span style=color:#f92672>=</span> data[c]
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>dropna(axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;any&#39;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> c <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> zeros_allowed:
</span></span><span style=display:flex><span>        df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>iloc[np<span style=color:#f92672>.</span>where(df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>!=</span><span style=color:#ae81ff>0</span>)[<span style=color:#ae81ff>0</span>],:]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    df[<span style=color:#e6db74>&#39;cap&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>.</span>median()
</span></span><span style=display:flex><span>    m <span style=color:#f92672>=</span> Prophet(growth<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;logistic&#39;</span>, yearly_seasonality<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    m<span style=color:#f92672>.</span>fit(df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    future <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>make_future_dataframe(periods<span style=color:#f92672>=</span><span style=color:#ae81ff>365</span>, freq<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;D&#39;</span>)
</span></span><span style=display:flex><span>    future[<span style=color:#e6db74>&#39;cap&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;y&#39;</span>]<span style=color:#f92672>.</span>median()
</span></span><span style=display:flex><span>    future<span style=color:#f92672>.</span>tail()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    forecast <span style=color:#f92672>=</span> m<span style=color:#f92672>.</span>predict(future)
</span></span><span style=display:flex><span>    forecast[[<span style=color:#e6db74>&#39;ds&#39;</span>, <span style=color:#e6db74>&#39;yhat&#39;</span>, <span style=color:#e6db74>&#39;yhat_lower&#39;</span>, <span style=color:#e6db74>&#39;yhat_upper&#39;</span>]]<span style=color:#f92672>.</span>tail()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m<span style=color:#f92672>.</span>plot(forecast, xlabel<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>, ax<span style=color:#f92672>=</span>a);
</span></span><span style=display:flex><span>    a<span style=color:#f92672>.</span>set_title(c)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#m.plot_components(forecast);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>suptitle(<span style=color:#e6db74>&#39;1-year prediction per variable from 1 year of fitbit data&#39;</span>, y<span style=color:#f92672>=</span><span style=color:#ae81ff>1.02</span>, fontsize<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>);
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>tight_layout()
</span></span></code></pre></div><pre><code>INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
/Users/dario/anaconda/envs/datasci/lib/python3.6/site-packages/pystan/misc.py:399: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  elif np.issubdtype(np.asarray(v).dtype, float):
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
INFO:fbprophet.forecaster:Disabling daily seasonality. Run prophet with daily_seasonality=True to override this.
</code></pre><p><img alt=png loading=lazy src=/images/2018-04-01-fitbit_prophet_files/2018-04-01-fitbit_prophet_44_1.png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.arcosdiaz.com/blog/tags/time-series/>Time Series</a></li><li><a href=https://www.arcosdiaz.com/blog/tags/wearables/>Wearables</a></li><li><a href=https://www.arcosdiaz.com/blog/tags/forecasting/>Forecasting</a></li></ul><nav class=paginav><a class=prev href=https://www.arcosdiaz.com/blog/posts/2019-12-15-btc-fraud-detection/><span class=title>« Prev</span><br><span>Graph Convolutional Networks for Fraud Detection of Bitcoin Transactions</span>
</a><a class=next href=https://www.arcosdiaz.com/blog/posts/2017-10-07-personalized-medicine/><span class=title>Next »</span><br><span>Personalized Medicine Kaggle Competition</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://www.arcosdiaz.com/blog/>Dario Arcos-Díaz, PhD</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>